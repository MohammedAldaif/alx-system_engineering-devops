#!/bin/bash

# Check if the password argument is provided
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <mysql_root_password>"
    exit 1
fi

# Get the MySQL root password from the argument
MYSQL_ROOT_PASSWORD=$1

# Define the dump file name
DUMP_FILE="backup.sql"

# Define the archive name based on the current date
ARCHIVE_NAME=$(date +'%d-%m-%Y').tar.gz

# Generate the MySQL dump
mysqldump -u root -p"$MYSQL_ROOT_PASSWORD" --all-databases > "$DUMP_FILE"

# Check if the dump was successful
if [ $? -ne 0 ]; then
    echo "MySQL dump failed!"
    exit 1
fi

# Create a compressed tar.gz archive of the dump file
tar -czf "$ARCHIVE_NAME" "$DUMP_FILE"

# Check if the archive creation was successful
if [ $? -ne 0 ]; then
    echo "Failed to create archive!"
    exit 1
fi

# Clean up the dump file
rm "$DUMP_FILE"

echo "Backup and compression successful: $ARCHIVE_NAME"
